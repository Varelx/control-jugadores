<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Control de Jugadores Juvenil</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Chart.js para gr√°ficas si se necesitan estad√≠sticas -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Google Calendar Lite para visualizar asistencia -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet">

<!-- Estilos modernos y juveniles -->
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600&display=swap" rel="stylesheet">
<style>
/* ===================== General ===================== */
body { font-family: 'Quicksand', sans-serif; background:#f0f8f5; margin:0; padding:0; }
header { background:#2e7d32; color:white; padding:20px; text-align:center; font-size:1.6em; font-weight:600; }
.container { max-width:1200px; margin:20px auto; padding:20px; background:white; border-radius:12px; box-shadow:0 6px 15px rgba(0,0,0,0.1); }
button { padding:10px 16px; border:none; border-radius:8px; background:#2e7d32; color:white; cursor:pointer; margin:2px; transition:0.3s; font-weight:500; }
button:hover { background:#1b5e20; }
input, select { padding:8px; margin:6px 0; border-radius:6px; border:1px solid #ccc; font-size:0.95em; }
.card { background:white; border:1px solid #ddd; border-radius:10px; padding:15px; margin:10px; box-shadow:0 4px 8px rgba(0,0,0,0.05); cursor:pointer; transition:0.3s; }
.card:hover { box-shadow:0 6px 12px rgba(0,0,0,0.1); }
.card .info { flex:1; display:flex; justify-content: space-between; align-items:center; }
.tabs { margin:10px 0; }
.tabs button { background:#d0f0e0; color:#2e7d32; }
.tabs button.active { background:#2e7d32; color:white; }
.player-details { display:none; margin-top:10px; background:#f7fff7; padding:10px; border-radius:8px; }
.attendance-buttons button { margin-right:5px; }
.calendar { max-width:100%; margin-top:10px; }
</style>
</head>
<body>
<header>
  <h1>üèâ CDZ Checking</h1>
</header>
<div class="container">

<!-- ===================== Registro / Login ===================== -->
<div id="authBox">
  <h2>Entrenadores</h2>
  <input type="email" id="email" placeholder="Email"><br>
  <input type="password" id="password" placeholder="Contrase√±a"><br>
  <button onclick="login()">Iniciar sesi√≥n</button>
  <button onclick="register()">Registrarse</button>
  <p id="authMsg"></p>
</div>

<!-- ===================== √Årea admin ===================== -->
<div>
  <h2>√Årea de Administraci√≥n</h2>
  <input type="password" id="adminPassword" placeholder="Contrase√±a"><br>
  <button onclick="showAdmin()">Acceder</button>
  <div id="adminArea" style="display:none; margin-top:10px;">
    <h3>Solicitudes pendientes</h3>
    <div id="requestsList"></div>
  </div>
</div>

<!-- ===================== Gesti√≥n de Jugadores ===================== -->
<div id="app" style="display:none;">
  <h2>Gesti√≥n de Jugadores</h2>
  <!-- Filtros de categor√≠as -->
  <div class="tabs">
    <button class="tabBtn active" onclick="filterCategory('M14')">M14</button>
    <button class="tabBtn" onclick="filterCategory('M16')">M16</button>
    <button class="tabBtn" onclick="filterCategory('M18')">M18</button>
    <button class="tabBtn" onclick="filterCategory('all')">Todos</button>
  </div>

  <!-- Formulario de nuevo jugador -->
  <div>
    <input type="text" id="playerName" placeholder="Nombre completo">
    <input type="date" id="playerBirth">
    <input type="text" id="fatherName" placeholder="Nombre padre">
    <input type="tel" id="fatherPhone" placeholder="Tel√©fono padre">
    <input type="text" id="motherName" placeholder="Nombre madre">
    <input type="tel" id="motherPhone" placeholder="Tel√©fono madre">
    <select id="categorySelect">
      <option value="M14">M14</option>
      <option value="M16">M16</option>
      <option value="M18">M18</option>
    </select>
    <button onclick="addPlayer()">‚ûï A√±adir jugador</button>
  </div>

  <!-- Contenedor de jugadores -->
  <div id="playersContainer"></div>
</div>

<script>
/* ===================== Firebase Config ===================== */
const firebaseConfig = {
  apiKey: "AIzaSyC-DTX0x8Bebk6Z1TEkyyVD3K4jOPVSmLA",
  authDomain: "control-jugadores-64ae6.firebaseapp.com",
  databaseURL: "https://control-jugadores-64ae6-default-rtdb.firebaseio.com",
  projectId: "control-jugadores-64ae6",
  storageBucket: "control-jugadores-64ae6.firebasestorage.app",
  messagingSenderId: "345003884874",
  appId: "1:345003884874:web:51308a576a636b5a9741b3",
  measurementId: "G-1RR2CLEPL1"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();
const MASTER_PASSWORD = '123123';
let currentCategory = 'all';

/* ===================== Registro y Login ===================== */
function register(){
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  auth.createUserWithEmailAndPassword(email,password).then(user=>{
    db.ref('users/'+user.user.uid).set({email:email,status:'pendiente'});
    document.getElementById('authMsg').innerText='Registrado, pendiente de aprobaci√≥n';
  }).catch(e=>document.getElementById('authMsg').innerText=e.message);
}

function login(){
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  auth.signInWithEmailAndPassword(email,password).catch(e=>document.getElementById('authMsg').innerText=e.message);
}

auth.onAuthStateChanged(user=>{
  if(user){
    db.ref('users/'+user.uid+'/status').once('value',snap=>{
      if(snap.val()==='aprobado'){
        document.getElementById('authBox').style.display='none';
        document.getElementById('app').style.display='block';
        loadPlayers();
      }
    });
  }
});

/* ===================== √Årea Admin ===================== */
function showAdmin(){
  const pass = document.getElementById('adminPassword').value;
  if(pass!==MASTER_PASSWORD){alert('Contrase√±a incorrecta'); return;}
  document.getElementById('adminArea').style.display='block';
  loadRequests();
}

function loadRequests(){
  const container = document.getElementById('requestsList');
  db.ref('users').on('value',snap=>{
    container.innerHTML='';
    snap.forEach(child=>{
      const u = child.val();
      if(u.status==='pendiente'){
        const div = document.createElement('div');
        div.innerHTML=`${u.email} <button onclick='approveUser("${child.key}")'>Aprobar</button>`;
        container.appendChild(div);
      }
    });
  });
}
function approveUser(uid){ db.ref('users/'+uid+'/status').set('aprobado'); }

/* ===================== Gesti√≥n de Jugadores ===================== */
function addPlayer(){
  const name = document.getElementById('playerName').value;
  const birth = document.getElementById('playerBirth').value;
  const fatherName = document.getElementById('fatherName').value;
  const fatherPhone = document.getElementById('fatherPhone').value;
  const motherName = document.getElementById('motherName').value;
  const motherPhone = document.getElementById('motherPhone').value;
  const category = document.getElementById('categorySelect').value;
  if(!name) return alert('Nombre requerido');
  const ref = db.ref('players').push();
  ref.set({name,birth,fatherName,fatherPhone,motherName,motherPhone,category,attendance:{}});
  ['playerName','playerBirth','fatherName','fatherPhone','motherName','motherPhone'].forEach(id=>document.getElementById(id).value='');
}

function loadPlayers(){
  const container = document.getElementById('playersContainer');
  db.ref('players').on('value',snap=>{
    container.innerHTML='';
    snap.forEach(child=>{
      const p = child.val();
      const id = child.key;
      if(currentCategory==='all' || p.category===currentCategory){
        const div = document.createElement('div');
        div.className='card';
        div.innerHTML=`
          <div class='info'>
            <strong>${p.name}</strong>
            <div class='attendance-buttons'>
              <button onclick='markAttendance("${id}",true)'>‚úÖ Asistencia</button>
              <button onclick='markAttendance("${id}",false)'>‚ùå No asistencia</button>
            </div>
            <button onclick='toggleDetails("${id}")'>Ver / Editar</button>
          </div>
          <div class='player-details' id='details_${id}'>
            Nacimiento: <input value='${p.birth}' onchange='updateField("${id}","birth",this.value)'><br>
            Padre: <input value='${p.fatherName}' onchange='updateField("${id}","fatherName",this.value)'> (<input value='${p.fatherPhone}' onchange='updateField("${id}","fatherPhone",this.value)'>)<br>
            Madre: <input value='${p.motherName}' onchange='updateField("${id}","motherName",this.value)'> (<input value='${p.motherPhone}' onchange='updateField("${id}","motherPhone",this.value)'>)<br>
            <div id='calendar_${id}' class='calendar'></div>
            <button onclick='deletePlayer("${id}")'>üóëÔ∏è Borrar jugador</button>
          </div>
        `;
        container.appendChild(div);
        renderCalendar(id,p.attendance);
      }
    });
  });
}

/* ===================== Funciones de asistencia ===================== */
function markAttendance(id,presente){
  const today = new Date().toISOString().slice(0,10);
  db.ref('players/'+id+'/attendance/'+today).set(presente);
}

/* ===================== Renderizar calendario ===================== */
function renderCalendar(id,attendance){
  const calendarEl = document.getElementById('calendar_'+id);
  calendarEl.innerHTML=''; // Limpiar
  const events = [];
  for(const date in attendance){
    events.push({title:attendance[date]? '‚úÖ':'‚ùå', start:date, color:attendance[date]? 'green':'red'});
  }
  const calendar = new FullCalendar.Calendar(calendarEl,{
    initialView: 'dayGridMonth',
    events: events
  });
  calendar.render();
}

/* ===================== Editar y borrar ===================== */
function toggleDetails(id){
  const el = document.getElementById('details_'+id);
  el.style.display = (el.style.display==='none')?'block':'none';
}
function updateField(id,field,value){
  db.ref('players/'+id+'/'+field).set(value);
}
function deletePlayer(id){
  if(confirm('¬øSeguro que quieres borrar este jugador?')){
    db.ref('players/'+id).remove();
  }
}

/* ===================== Filtrar por categor√≠a ===================== */
function filterCategory(cat){
  currentCategory=cat;
  document.querySelectorAll('.tabBtn').forEach(btn=>btn.classList.remove('active'));
  Array.from(document.querySelectorAll('.tabBtn')).find(b=>b.textContent===cat || cat==='Todos').classList.add('active');
  loadPlayers();
}
</script>
</body>
</html>
