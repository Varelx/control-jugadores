<!DOCTYPE html>
<html lang="es">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="UTF-8">
<title>üèâ Entrenadores CDZ</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Estilos -->
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600&display=swap" rel="stylesheet">
<style>
* { box-sizing:border-box; }
body { font-family:'Quicksand', sans-serif; background:#fafafa; margin:0; padding:0; }

/* Barra superior */
header {
  position: sticky; 
  top: 0; 
  z-index: 100;
  background: #2e7d32; /* verde */
  border-bottom: 1px solid #1b5e20; /* verde m√°s oscuro */
  display: flex; 
  align-items: center; 
  justify-content: space-between;
  padding: 8px 14px;
}

header img { height: 40px; }

header h1 { 
  font-size: 1.3em; 
  margin: 0; 
  color: white; 
  font-weight: 600; 
}

/* Contenedor principal tipo feed */
.container { max-width:600px; margin:20px auto; padding:0 10px; }

/* Botones principales (verde) */
button {
  border:none; border-radius:8px;
  padding:8px 14px;
  background:#2e7d32; color:white;
  font-weight:600; cursor:pointer;
}
button:hover { background:#1b5e20; }

/* Inputs y selects */
input, select {
  width:100%; padding:10px; margin:6px 0;
  border:1px solid #dbdbdb; border-radius:6px; font-size:0.95em;
}

/* Tarjetas tipo post */
.card {
  background:white;
  border:1px solid #dbdbdb;
  border-radius:12px;
  margin-bottom:20px;
  padding:15px;
}
.card strong { font-size:1.1em; }
.card .info { display:flex; flex-direction:column; gap:8px; }

/* Detalles ocultos */
.player-details {
  display:none; margin-top:12px;
  border-top:1px solid #eee; padding-top:12px;
}

/* Tabs */
.tabs { display:flex; gap:5px; margin:10px 0; }
.tabs button {
  flex:1; background:#efefef; color:#262626;
}
.tabs button.active { background:#2e7d32; color:white; }

/* Botones de asistencia */
.attendance-buttons { display:flex; gap:5px; }
.attendance-buttons button {
  flex:1;
  background:#e0e0e0;
  color:#333;
  border:1px solid #ccc;
}
.attendance-buttons button.asistio {
  background:#2e7d32; color:white; border:none;
}
.attendance-buttons button.falto {
  background:#c62828; color:white; border:none;
}

/* Tablas */
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td {
  border:1px solid #ccc; padding:6px; text-align:center;
  font-size:0.9em;
}
th { background:#f5f5f5; }

/* Responsive */
@media (max-width:768px) {
  header { flex-direction:row; }
}
</style>
</head>
<body>
<header>
  <img src="https://github.com/Varelx/control-jugadores/blob/main/Arteixo%20sin%20fondo.png?raw=true" alt="Club Rugby Zalaeta">
  <h1>Entrenadores CDZ</h1>
  <div id="menuContainer" style="display:none;">
    <select id="menuSelect" onchange="switchView()">
      <option value="players">Jugadores</option>
      <option value="admin">√Årea Administraci√≥n</option>
    </select>
  </div>
</header>

<div class="container">

<!-- Auth -->
<div id="authBox">
  <h2>Entrenadores</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Contrase√±a">
  <button onclick="login()">Iniciar sesi√≥n</button>
  <button onclick="register()">Registrarse</button>
  <p id="authMsg"></p>
</div>

<!-- App -->
<div id="app" style="display:none;">
  <div class="tabs">
    <button class="tabBtn" onclick="filterCategory('M8')">M8</button>
    <button class="tabBtn" onclick="filterCategory('M10')">M10</button>
    <button class="tabBtn" onclick="filterCategory('M12')">M12</button>
    <button class="tabBtn" onclick="filterCategory('M14')">M14</button>
    <button class="tabBtn" onclick="filterCategory('M16')">M16</button>
    <button class="tabBtn" onclick="filterCategory('M18')">M18</button>
    <button class="tabBtn" onclick="filterCategory('Masc')">Masc</button>
  </div>
  <button id="toggleFormBtn">‚ûï A√±adir jugador</button>
  <div id="addPlayerForm" style="display:none; margin-top:10px;">
    <input type="text" id="playerName" placeholder="Nombre completo">
    <input type="date" id="playerBirth">
    <input type="text" id="fatherName" placeholder="Nombre padre">
    <input type="tel" id="fatherPhone" placeholder="Tel√©fono padre">
    <input type="text" id="motherName" placeholder="Nombre madre">
    <input type="tel" id="motherPhone" placeholder="Tel√©fono madre">
    <select id="categorySelect">
      <option value="M8">M8</option>
      <option value="M10">M10</option>
      <option value="M12">M12</option>
      <option value="M14">M14</option>
      <option value="M16">M16</option>
      <option value="M18">M18</option>
      <option value="Masc">Masc</option>
    </select>
    <button onclick="addPlayer()">Guardar jugador</button>
  </div>
  <div id="playersContainer"></div>
</div>

<!-- √Årea Admin -->
<div id="adminArea" style="display:none;">
  <h2>√Årea de Administraci√≥n</h2>
  <input type="password" id="adminPassword" placeholder="Contrase√±a">
  <button onclick="showAdmin()">Acceder</button>
  <div id="requestsList" style="margin-top:10px;"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const firebaseConfig = {
    apiKey: "AIzaSyC-DTX0x8Bebk6Z1TEkyyVD3K4jOPVSmLA",
    authDomain: "control-jugadores-64ae6.firebaseapp.com",
    databaseURL: "https://control-jugadores-64ae6-default-rtdb.firebaseio.com",
    projectId: "control-jugadores-64ae6",
    storageBucket: "control-jugadores-64ae6.firebasestorage.app",
    messagingSenderId: "345003884874",
    appId: "1:345003884874:web:51308a576a636b5a9741b3",
    measurementId: "G-1RR2CLEPL1"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const auth = firebase.auth();
  const MASTER_PASSWORD = '123123';
  let currentCategory = 'all';

  function register(){
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    auth.createUserWithEmailAndPassword(email,password).then(user=>{
      db.ref('users/'+user.user.uid).set({email:email,status:'pendiente'});
      document.getElementById('authMsg').innerText='Registrado, pendiente de aprobaci√≥n';
    }).catch(e=>document.getElementById('authMsg').innerText=e.message);
  }
  function login(){
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    auth.signInWithEmailAndPassword(email,password).catch(e=>document.getElementById('authMsg').innerText=e.message);
  }
  auth.onAuthStateChanged(user=>{
    if(user){
      db.ref('users/'+user.uid+'/status').once('value',snap=>{
        if(snap.val()==='aprobado'){
          document.getElementById('authBox').style.display='none';
          document.getElementById('app').style.display='block';
          document.getElementById('menuContainer').style.display='block';
          loadPlayers();
        }
      });
    } else { document.getElementById('menuContainer').style.display='none'; }
  });

  function showAdmin(){
    const pass = document.getElementById('adminPassword').value;
    if(pass!==MASTER_PASSWORD){alert('Contrase√±a incorrecta'); return;}
    document.getElementById('requestsList').innerHTML='';
    db.ref('users').once('value',snap=>{
      snap.forEach(child=>{
        const u = child.val();
        if(u.status==='pendiente'){
          const div = document.createElement('div');
          div.innerHTML=`${u.email} <button onclick='approveUser("${child.key}")'>Aprobar</button>`;
          document.getElementById('requestsList').appendChild(div);
        }
      });
    });
  }
  function approveUser(uid){ db.ref('users/'+uid+'/status').set('aprobado'); }

  function addPlayer(){
    const name = document.getElementById('playerName').value;
    const birth = document.getElementById('playerBirth').value;
    const fatherName = document.getElementById('fatherName').value;
    const fatherPhone = document.getElementById('fatherPhone').value;
    const motherName = document.getElementById('motherName').value;
    const motherPhone = document.getElementById('motherPhone').value;
    const category = document.getElementById('categorySelect').value;
    if(!name) return alert('Nombre requerido');
    const ref = db.ref('players').push();
    ref.set({name,birth,fatherName,fatherPhone,motherName,motherPhone,category,attendance:{}});
    ['playerName','playerBirth','fatherName','fatherPhone','motherName','motherPhone'].forEach(id=>document.getElementById(id).value='');
  }

  function loadPlayers(){
    const container = document.getElementById('playersContainer');
    db.ref('players').on('value', snap => {
      container.innerHTML = '';
      snap.forEach(child => {
        const p = child.val();
        const id = child.key;
        if (currentCategory === 'all' || p.category === currentCategory) {
          const div = document.createElement('div');
          div.className = 'card';
          div.innerHTML = `
            <div class='info'>
              <strong>${p.name}</strong>
              <div class='attendance-buttons'>
                <button id='asist_${id}' onclick='markAttendance("${id}",true)'>‚úÖ Asistencia</button>
                <button id='falta_${id}' onclick='markAttendance("${id}",false)'>‚ùå No asistencia</button>
              </div>
              <button onclick='toggleDetails("${id}")'>Ver / Editar</button>
            </div>
            <div class='player-details' id='details_${id}'>
              <small>Nacimiento:</small> <input value='${p.birth}' onchange='updateField("${id}","birth",this.value)'><br>
              <small>Padre:</small> <input value='${p.fatherName}' onchange='updateField("${id}","fatherName",this.value)'> 
              <small>N¬∫ Tlf. Padre:<small><input value='${p.fatherPhone}' onchange='updateField("${id}","fatherPhone",this.value)'><br>
              <small>Madre:</small> <input value='${p.motherName}' onchange='updateField("${id}","motherName",this.value)'> 
              <small>N¬∫ Tlf. Madre:<small><input value='${p.motherPhone}' onchange='updateField("${id}","motherPhone",this.value)'><br>
              <table id='attendance_${id}'><tr><th>Fecha</th><th>Asistencia</th></tr></table>
              <button onclick='deletePlayer("${id}")'>üóëÔ∏è Borrar jugador</button>
            </div>`;
          container.appendChild(div);
          renderAttendanceTable(id, p.attendance);
          updateAttendanceButtons(id, p.attendance);
        }
      });
    });
  }

  function markAttendance(id,presente){
    const today = new Date().toISOString().slice(0,10);
    db.ref('players/'+id+'/attendance/'+today).set(presente).then(()=>loadPlayers());
  }

  function renderAttendanceTable(id, attendance){
    const table = document.getElementById('attendance_'+id);
    table.innerHTML = '<tr><th>Fecha</th><th>Asistencia</th></tr>';
    for(const date in attendance){
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${date}</td><td>${attendance[date] ? '‚úÖ' : '‚ùå'}</td>`;
      table.appendChild(tr);
    }
  }

  function updateAttendanceButtons(id, attendance){
    const today = new Date().toISOString().slice(0,10);
    const asistBtn = document.getElementById('asist_'+id);
    const faltaBtn = document.getElementById('falta_'+id);
    asistBtn.classList.remove('asistio');
    faltaBtn.classList.remove('falto');
    if(attendance && attendance[today]!==undefined){
      if(attendance[today]) asistBtn.classList.add('asistio');
      else faltaBtn.classList.add('falto');
    }
  }

  function toggleDetails(id){
    const el = document.getElementById('details_'+id);
    el.style.display = (el.style.display==='none' || el.style.display==='')?'block':'none';
  }
  function updateField(id,field,value){ db.ref('players/'+id+'/'+field).set(value); }
  function deletePlayer(id){ if(confirm('¬øSeguro?')) db.ref('players/'+id).remove(); }
  function filterCategory(cat){
    currentCategory=cat;
    document.querySelectorAll('.tabBtn').forEach(btn=>btn.classList.remove('active'));
    Array.from(document.querySelectorAll('.tabBtn')).find(b=>b.textContent===cat).classList.add('active');
    loadPlayers();
  }
  
  window.switchView = function(){
    const val = document.getElementById('menuSelect').value;
    document.getElementById('app').style.display = (val==='players')?'block':'none';
    document.getElementById('adminArea').style.display = (val==='admin')?'block':'none';
  }
  document.getElementById('toggleFormBtn').addEventListener('click', () => {
    const form = document.getElementById('addPlayerForm');
    form.style.display = (form.style.display==='none'||form.style.display==='') ? 'block':'none';
  });

  window.register = register;
  window.login = login;
  window.showAdmin = showAdmin;
  window.approveUser = approveUser;
  window.addPlayer = addPlayer;
  window.markAttendance = markAttendance;
  window.renderAttendanceTable = renderAttendanceTable;
  window.toggleDetails = toggleDetails;
  window.updateField = updateField;
  window.deletePlayer = deletePlayer;
  window.filterCategory = filterCategory;
});
</script>
</body>
</html>
