<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Control de Jugadores - Entrenadores</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f4f4f4; }
    input, button { margin: 5px 0; padding: 8px; }
    #app, #adminArea { display:none; margin-top:20px; }
  </style>
</head>
<body>
  <h1>üìã Control de Jugadores</h1>

  <!-- Registro y Login de entrenadores -->
  <div id="authBox">
    <h2>Registro / Login</h2>
    <input type="email" id="email" placeholder="Email"><br>
    <input type="password" id="password" placeholder="Contrase√±a"><br>
    <button onclick="register()">Registrarse</button>
    <button onclick="login()">Iniciar sesi√≥n</button>
    <p id="authMsg"></p>
  </div>

  <!-- √Årea admin protegida por contrase√±a maestra -->
  <div>
    <h2>√Årea de administraci√≥n</h2>
    <input type="password" id="adminPassword" placeholder="Contrase√±a maestra">
    <button onclick="showAdmin()">Acceder</button>
    <div id="adminArea">
      <h3>Solicitudes de entrenadores pendientes</h3>
      <table id="requestsTable">
        <thead><tr><th>Email</th><th>Acci√≥n</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- App de gesti√≥n de jugadores -->
  <div id="app">
    <h2>Gesti√≥n de jugadores</h2>
    <input type="text" id="playerName" placeholder="Nombre completo">
    <input type="date" id="playerBirth">
    <input type="tel" id="playerPhone" placeholder="Tel√©fono">
    <button onclick="addPlayer()">‚ûï A√±adir jugador</button>

    <h3>Asistencia</h3>
    <input type="date" id="trainingDate">
    <script>document.getElementById("trainingDate").valueAsDate = new Date();</script>

    <table id="playersTable">
      <thead>
        <tr>
          <th>Nombre</th><th>F. nacimiento</th><th>Tel√©fono</th><th>Asiste</th><th>Nota</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // Configuraci√≥n Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyC-DTX0x8Bebk6Z1TEkyyVD3K4jOPVSmLA",
      authDomain: "control-jugadores-64ae6.firebaseapp.com",
      databaseURL: "https://control-jugadores-64ae6-default-rtdb.firebaseio.com",
      projectId: "control-jugadores-64ae6",
      storageBucket: "control-jugadores-64ae6.firebasestorage.app",
      messagingSenderId: "345003884874",
      appId: "1:345003884874:web:51308a576a636b5a9741b3",
      measurementId: "G-1RR2CLEPL1"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    const MASTER_PASSWORD = "123123"; // Cambia aqu√≠ la contrase√±a maestra

    // Registro
    function register() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.createUserWithEmailAndPassword(email, password)
        .then(userCredential => {
          const uid = userCredential.user.uid;
          db.ref('users/' + uid).set({ email: email, status: 'pendiente' });
          document.getElementById('authMsg').innerText = 'Registrado, pendiente de aprobaci√≥n';
        })
        .catch(error => { document.getElementById('authMsg').innerText = error.message; });
    }

    // Login
    function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.signInWithEmailAndPassword(email, password)
        .then(userCredential => {
          const uid = userCredential.user.uid;
          db.ref('users/' + uid + '/status').once('value', snap => {
            if (snap.val() === 'aprobado') {
              document.getElementById('authBox').style.display = 'none';
              document.getElementById('app').style.display = 'block';
              loadPlayers();
            } else {
              document.getElementById('authMsg').innerText = 'Usuario pendiente de aprobaci√≥n';
              auth.signOut();
            }
          });
        })
        .catch(error => { document.getElementById('authMsg').innerText = error.message; });
    }

    // Mostrar √°rea admin
    function showAdmin() {
      const pass = document.getElementById('adminPassword').value;
      if(pass !== MASTER_PASSWORD){ alert('Contrase√±a incorrecta'); return; }
      document.getElementById('adminArea').style.display = 'block';
      loadRequests();
    }

    // Cargar solicitudes pendientes
    function loadRequests(){
      const tbody = document.querySelector('#requestsTable tbody');
      db.ref('users').on('value', snap => {
        tbody.innerHTML = '';
        snap.forEach(child => {
          const user = child.val();
          if(user.status === 'pendiente'){
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${user.email}</td><td><button onclick="approveUser('${child.key}')">Aprobar</button></td>`;
            tbody.appendChild(tr);
          }
        });
      });
    }

    function approveUser(uid){
      db.ref('users/' + uid + '/status').set('aprobado');
    }

    // A√±adir jugador
    function addPlayer(){
      const name = document.getElementById('playerName').value;
      const birth = document.getElementById('playerBirth').value;
      const phone = document.getElementById('playerPhone').value;
      if(!name) return alert('Pon el nombre del jugador');
      const newRef = db.ref('players').push();
      newRef.set({name, birth, phone});
      document.getElementById('playerName').value='';
      document.getElementById('playerBirth').value='';
      document.getElementById('playerPhone').value='';
    }

    // Cargar jugadores
    function loadPlayers(){
      const tbody = document.querySelector('#playersTable tbody');
      db.ref('players').on('value', snap => {
        tbody.innerHTML='';
        snap.forEach(child => {
          const player = child.val();
          const id = child.key;
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${player.name}</td><td>${player.birth || ''}</td><td>${player.phone || ''}</td>
            <td><input type='checkbox' onchange="markAttendance('${id}', this.checked)"></td>
            <td><input type='text' onblur="saveNote('${id}', this.value)"></td>`;
          tbody.appendChild(tr);
        });
      });
    }

    function markAttendance(playerId, present){
      const date = document.getElementById('trainingDate').value;
      db.ref('attendance/'+date+'/'+playerId).set(present);
    }

    function saveNote(playerId, note){
      const date = document.getElementById('trainingDate').value;
      db.ref('notes/'+date+'/'+playerId).set(note);
    }
  </script>
</body>
</html>
